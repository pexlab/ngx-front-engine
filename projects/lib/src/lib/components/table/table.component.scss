@use 'assets/fe-styles/theme' with ($scope: 'table');
@use 'assets/fe-styles/utils';

:host {

    display            : grid;
    grid-auto-flow     : row;
    grid-template-rows : auto auto 1fr;

    width              : 100%;
    height             : utils.fes(45);

    & > .heading {

        width           : 100%;
        height          : fit-content;

        display         : grid;
        grid-auto-flow  : column;

        align-items     : center;
        justify-content : left;

        border          : utils.fes(.06) solid theme.hex('outline');
        border-radius   : utils.maxValue();

        overflow        : hidden;

        background      : theme.hex('background-header');

        &.left {
            justify-content : left;
        }

        &.center {
            justify-content : center;
        }

        &.right {
            justify-content : end;
        }

        @include theme.commonFont('decorative');

        & > .title {

            height          : utils.fes(3);

            box-sizing      : content-box;
            padding         : 0 utils.fes(.8);

            display         : grid;
            grid-auto-flow  : column;
            grid-gap        : utils.fes(.5);
            align-items     : center;
            justify-content : start;

            white-space     : nowrap;

            @include theme.inlineIcon(utils.fes(1.2));

            cursor          : pointer;

            transition      : background .25s ease;

            @include utils.hover {
                background : theme.hex('highlight-header');
            }
        }

        & > .select {

            display        : grid;
            grid-auto-flow : column;
            place-items    : center;

            box-sizing     : content-box;
            padding        : 0 utils.fes(.8) 0 utils.fes(.8);

            @include theme.inlineIcon(utils.fes(1.2));

            & > fe-checkbox {
                margin : 0 utils.fes(1);
            }

            & > svg-icon {
                opacity : 0;
            }
        }

        & > .divider {
            height           : 50%;
            width            : utils.fes(.06);
            background-color : theme.hex('outline');
        }
    }

    & > .connector {

        position     : relative;

        justify-self : center;
        width        : fit-content;

        display      : grid;

        box-sizing   : content-box;

        &.even {

            grid-auto-flow        : column;
            grid-template-columns : 1fr utils.fes(.06) 1fr;
            grid-gap              : utils.fes(1.75);

            & > .right, & > .left {
                display        : grid;
                grid-auto-flow : column;
                grid-gap       : utils.fes(1.75);
                margin         : utils.fes(1.75) 0;
            }

            & > .left {
                justify-self : right;
            }

            & > .right {
                justify-self : left;
            }

            & > .divider {
                background-color : theme.hex('outline');
            }
        }

        &.odd {

            grid-auto-flow : column;
            grid-gap       : utils.fes(1.75);

            padding        : utils.fes(1.75) 0;

            & > .divider {

                display            : grid;
                grid-auto-flow     : row;
                grid-template-rows : 1fr 3fr 1fr;

                position           : absolute;
                left               : 50%;
                transform          : translateX(-50%);

                & > div {
                    width  : 100%;
                    height : 100%;
                }

                & > .a, & > .b {
                    background-color : theme.hex('outline');
                    transition       : .25s ease background-color;
                }
            }

            & > fe-button {

                z-index  : 1;
                position : relative;

                @include utils.middle-child-of-type(12) {
                    @include utils.hover {
                        & ~ .divider {
                            & > .b {
                                background-color : transparent;
                            }
                        }
                    }
                }
            }
        }

        &.none {

            height : utils.fes(2);

            & > .divider {
                background-color : theme.hex('outline');
            }
        }

        & > .divider {
            width  : utils.fes(.06);
            height : 100%;
        }
    }

    & > .content {

        position      : relative;

        width         : 100%;
        height        : 100%;

        border        : utils.fes(.06) solid theme.hex('outline');
        border-radius : utils.fes(1);

        overflow-y    : auto;
        overflow-x    : hidden;

        isolation     : isolate;

        background    : theme.hex('background-row-even');

        @include theme.inlineIcon(utils.fes(5.5));

        & > svg-icon {

            position  : absolute;

            left      : 50%;
            top       : 50%;

            transform : translate(-50%, -50%);

            color     : theme.hex('loader-circle');
        }

        & > .loader {

            position         : absolute;

            left             : 0;
            top              : 0;

            width            : 100%;
            height           : utils.fes(.75);

            display          : inline-block;

            box-sizing       : border-box;

            background-color : theme.hex('loader-stripe-a');
            background-image : linear-gradient(45deg, theme.hex('loader-stripe-b') 25%, transparent 25%, transparent 50%, theme.hex('loader-stripe-b') 50%, theme.hex('loader-stripe-b') 75%, transparent 75%, transparent);
            background-size  : utils.fes(1) utils.fes(1);

            animation        : fe-table_loaderStripe 1s linear infinite;
        }

        &.dragging {
            cursor : move;
        }

        & > .scroller {

            width  : 100%;
            height : 100%;

            @include theme.scrollbar(theme.hex('outline'), theme.hex('outline'), transparent, 'xy', utils.fes(0.5), utils.fes(0.25));

            &::ng-deep > .cdk-virtual-scroll-content-wrapper {

                position : relative;

                &,
                & > .wrapper {

                    min-width : fit-content;

                    & > .divider {

                        width      : 100%;
                        height     : 0;

                        transition : height .25s ease, border-top .25s ease;

                        border-top : utils.fes(.06) solid theme.hex('outline');

                        &.aim {
                            height        : var(--space);
                            border-bottom : utils.fes(.06) solid theme.hex('outline');
                        }

                        &.hideTopBorder {
                            border-top : 0 solid transparent;
                        }

                        &.hideBottomBorder {
                            border-bottom-color : transparent;
                        }
                    }

                    & > .row {

                        width           : 100%;

                        display         : grid;
                        grid-auto-flow  : column;
                        align-items     : center;
                        justify-content : start;

                        transition      : background .25s ease, margin-bottom .25s ease;

                        &.beingDragged {

                            /* Hide the real one as long as the dummy/clone is being freely dragged around */
                            display : none;

                            &, & > * {
                                pointer-events : none !important;
                            }
                        }

                        &.nonInteractive {

                            cursor : inherit;

                            /* Allow for hover event to be dispatched */
                            & {
                                pointer-events : visible;
                            }

                            /* Disallow for any content to be hovered on */
                            & > * {
                                pointer-events : none;
                            }
                        }

                        &.animateIn {
                            animation : fe-table_bounce 1000ms linear both;
                        }

                        /* A clone to freely drag around (showing a preview of the row) */
                        &.dragDummy {

                            z-index  : 1;

                            position : fixed;

                            &, & > * {
                                pointer-events : none !important;
                            }
                        }

                        & > .divider {

                            width            : utils.fes(.06);
                            height           : 50%;

                            background-color : theme.hex('outline');

                            transition       : opacity .25s ease;

                            &.hidden {
                                opacity : 0;
                            }

                            &, & > * {
                                pointer-events : none;
                            }
                        }

                        & > .cell {

                            position    : relative;

                            display     : grid;
                            place-items : center start;

                            box-sizing  : content-box;
                            padding     : utils.fes(.8);
                            min-height  : fit-content;
                            height      : utils.opFes('100% -', 1.6);

                            transition  : background .25s ease;

                            &.left {
                                place-items : center start;
                            }

                            &.center {
                                place-items : center center;
                            }

                            &.right {
                                place-items : center end;
                            }

                            &:after {

                                pointer-events : none;

                                z-index        : 0;
                                content        : '';
                                position       : absolute;
                                top            : 0;
                                left           : 0;
                                right          : 0;
                                bottom         : 0;

                                background     : theme.hex('highlight-cell');

                                border-left    : utils.fes(.06) solid theme.hex('highlight-outline');
                                border-right   : utils.fes(.06) solid theme.hex('highlight-outline');

                                opacity        : 0;
                                transition     : opacity .25s ease;
                            }

                            & > * {
                                position : relative;
                                z-index  : 1;
                            }

                            &.passThroughClick > * {
                                pointer-events : visible;
                            }

                            &.ignoreClick {
                                &, & > * {
                                    pointer-events : none;
                                    user-select    : none;
                                }
                            }

                            &.highlight:after {
                                opacity : 1;
                            }

                            &.inFirstRow:after {
                                top                     : utils.fes(.25);
                                border-top-right-radius : utils.fes(1);
                                border-top-left-radius  : utils.fes(1);
                                border-top              : utils.fes(.06) solid theme.hex('highlight-outline');
                            }

                            &.inLastRow:after {
                                bottom                     : utils.fes(.25);
                                border-bottom-right-radius : utils.fes(1);
                                border-bottom-left-radius  : utils.fes(1);
                                border-bottom              : utils.fes(.06) solid theme.hex('highlight-outline');
                            }

                            &.originalWidth {
                                white-space : nowrap;
                            }
                        }

                        & > .select {

                            height         : 100%;

                            display        : grid;
                            grid-auto-flow : column;
                            place-items    : center;

                            box-sizing     : content-box;
                            padding        : 0 utils.fes(.8) 0 utils.fes(.8);

                            touch-action   : none;

                            @include theme.inlineIcon(utils.fes(1.2));

                            &.reorderable {
                                cursor : grab;
                            }

                            @include utils.hover {
                                & > svg-icon {
                                    color : theme.hex('drag-handle-hover');
                                }
                            }

                            & > fe-checkbox {
                                margin : 0 utils.fes(1);
                                cursor : pointer;
                            }

                            & > svg-icon {
                                color      : theme.hex('drag-handle');
                                transition : color .25s ease;
                            }
                        }

                        &.even {
                            background : theme.hex('background-row-even');
                        }

                        &.odd {
                            background : theme.hex('background-row-odd');
                        }

                        @include utils.hover {
                            background : theme.hex('background-row-hover');
                        }

                        &.dragDummy {

                            &.even, &.odd {
                                background : transparent !important;
                            }

                            @include utils.hover {
                                background : transparent !important;
                            }
                        }
                    }
                }
            }
        }
    }
}

