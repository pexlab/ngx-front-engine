@use '../../../../assets/fe-styles/theme' with ($scope: 'dropdown');
@use '../../../../assets/fe-styles/utils';
@use 'sass:math';

@forward '../../../../assets/fe-styles/theme';
@forward '../../../../assets/fe-styles/utils';

$DROPDOWN_PADDING_VERTICAL   : 15px;
$DROPDOWN_PADDING_HORIZONTAL : 25px;
$PLACEHOLDER_HEIGHT          : 40px;
$OPTION_PADDING              : 10px;

:host {

    position    : relative;

    display     : block;

    box-sizing  : border-box;

    width       : fit-content;
    height      : $PLACEHOLDER_HEIGHT;

    user-select : none;

    /* Isolated stacking context for the placeholder panel and options hierarchy */
    isolation   : isolate;

    @include theme.commonFont('body');

    &.inline {
        margin-left  : $DROPDOWN_PADDING_HORIZONTAL;
        margin-right : $DROPDOWN_PADDING_HORIZONTAL;
    }

    & > * {
        margin : 0;
    }

    & > .placeholderPanel {

        z-index               : 2;

        position              : relative;

        user-select           : none;
        cursor                : pointer;

        width                 : fit-content;
        height                : $PLACEHOLDER_HEIGHT;

        padding               : 0 1rem;
        box-sizing            : border-box;

        display               : grid;
        grid-template-columns : 1fr auto;
        grid-gap              : 10px;
        place-items           : center;

        color                 : theme.hex('placeholder-idle-panel-text');
        border                : 2px solid theme.hex('placeholder-idle-panel-border');
        background            : theme.hex('placeholder-idle-panel-background');

        border-radius         : 99px;

        transition            : border-color .25s ease, color .25s ease, background-color .25s ease, box-shadow .25s ease;

        @include theme.inlineIcon(15px);

        &:focus {
            outline        : .1rem solid theme.hex('placeholder-idle-panel-border');
            outline-offset : .15rem;
        }

        &::after {
            opacity       : 0;
            position      : absolute;
            content       : '';
            display       : block;
            left          : -.1rem;
            top           : -.2rem;
            bottom        : -.2rem;
            right         : -.1rem;
            border-radius : 99px;
            box-sizing    : border-box;
            border-bottom : .2rem solid theme.hex('placeholder-border-bottom');
            transition    : opacity .25s ease;
        }

        &.passive-raised:not(.selected)::after {
            opacity : 1;
        }

        &.selected.active-raised::after {
            opacity : 1;
        }

        &.always-raised::after {
            opacity : 1;
        }

        &.selected {

            color      : theme.hex('placeholder-selected-panel-text');
            border     : 2px solid theme.hex('placeholder-selected-panel-border');
            background : theme.hex('placeholder-selected-panel-background');

            box-shadow : 0 14px 28px rgba(0, 0, 0, 0.15), 0 10px 10px rgba(0, 0, 0, 0.12);
        }

        & > ::ng-deep div {

            display        : grid;
            grid-auto-flow : column;
            grid-gap       : 10px;
            align-items    : center;

            width          : fit-content;
            height         : fit-content;

            @include theme.inlineIcon(20px);
        }
    }

    & > .options {

        opacity        : 1;

        z-index        : 1;

        position       : absolute;

        top            : math.div($PLACEHOLDER_HEIGHT, 2);
        left           : -$DROPDOWN_PADDING_HORIZONTAL;

        display        : grid;
        grid-auto-flow : row;

        min-width      : 200px;
        width          : calc(100% + (#{$DROPDOWN_PADDING_HORIZONTAL} * 2) + (#{$OPTION_PADDING} * 2));

        margin         : 0;
        padding-top    : math.div($PLACEHOLDER_HEIGHT, 2) + $DROPDOWN_PADDING_VERTICAL + 3px + $OPTION_PADDING;

        overflow       : hidden;

        border-radius  : 5px;

        background     : theme.hex('options-idle-background');

        box-shadow     : 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);

        transition     : background .25s ease;

        &:before {

            content    : '';

            position   : absolute;

            top        : 0;
            left       : 0;

            width      : 100%;
            height     : 3px;

            background : theme.hex('options-stripe');
        }

        & > .clear-value {

            $padding_top  : math.div($PLACEHOLDER_HEIGHT, 2) + $DROPDOWN_PADDING_VERTICAL;

            position      : absolute;

            top           : 3px + math.div($OPTION_PADDING, 2);
            right         : $OPTION_PADDING;

            display       : grid;
            place-items   : center;

            width         : $padding_top;
            height        : $padding_top;

            margin        : 0; /* Idk why but the margin from the parent is being applied to the children as well */

            border-radius : 99px;

            color         : theme.hex('clear-button-idle');
            background    : theme.hex('clear-button-idle-background');

            transition    : background-color .25s ease, color .25s ease;

            @include theme.inlineIcon(18px);

            @include utils.hover {
                color      : theme.hex('clear-button-hover');
                background : theme.hex('clear-button-hover-background');
            }

            &:focus {
                outline : none;
            }
        }

        ::ng-deep {
            & > * {
                cursor : pointer;
            }
        }

        &.disabled {
            ::ng-deep {
                & > * {
                    cursor : not-allowed;
                }
            }
        }
    }
}
